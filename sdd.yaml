version: 1.0
name: vicenteopaso-vibecode
description: >
  Personal site and CV built with Next.js App Router, Tailwind v4, Radix UI,
  and markdown/JSON content, with strong SEO, accessibility, and testing
  governance.

principles:
  - clean-code
  - accessibility
  - performance-budgets
  - security-first
  - content-first-seo
  - test-driven-changes
  - tool-agnostic-governance

stack:
  runtime: node-24-lts
  framework: nextjs-app-router
  language: typescript
  styling:
    - tailwindcss-v4
    - radix-ui
  content:
    - markdown + gray-matter
    - contentlayer-configured
  testing:
    unit: vitest + testing-library
    e2e: playwright
    visual: playwright-visual

standards:
  coding:
    languages: [ts, tsx, js]
    linting:
      command: pnpm lint
      config: eslint.config.mjs
    formatting:
      command: pnpm format
      tool: prettier
    typechecking:
      command: pnpm typecheck
  architecture:
    patterns:
      - feature-oriented-app-routes
      - server-components-first
      - presentational-components-in-app-components
      - pure-logic-in-lib
    boundaries:
      app:
        components: "UI-only; no direct fs or process.env access. Prefer props and lib helpers."
        api-routes: "Schema validation + side-effects only; business rules live in lib/* where possible."
        opengraph: "Locale-aware image generation in app/[lang]/opengraph-image.tsx and app/[lang]/cv/opengraph-image.tsx; accepts lang param for translations."
      lib:
        error-logging: "Centralized Sentry + console logging in lib/error-logging.ts."
        markdown: "Shared markdown component maps in lib/markdown-components.tsx."
        seo: "Single source of truth for site config, metadata, and JSON-LD in lib/seo.ts."
      content:
        about: "Frontmatter + markdown body in content/about.md."
        cv: "Frontmatter + JSON body in content/cv.md."
        i18n: "Locale detection and translations in lib/i18n/; opengraph images support en/es locales."
    prohibited:
      - shared mutable state across routes
      - cross-layer imports such as app/components importing app/api
      - bypassing error logging helpers in lib/error-logging.ts

accessibility:
  targets:
    - wcag-2.1-aa
  checks:
    manual:
      - keyboard-navigation
      - screen-reader-labeling
    automated:
      - "node scripts/audit-a11y.mjs"

performance:
  budgets:
    lighthouse-pwa: 90
    lighthouse-performance: 90

security:
  headers: next.config.mjs
  external-services:
    - cloudflare-turnstile
    - formspree
    - sentry
  rules:
    - "No secrets checked into the repo; always use environment variables."
    - "Do not weaken CSP, CORS, or security headers without explicit justification in PRs."

devex:
  commands:
    dev: pnpm dev
    build: pnpm build
    test-unit: pnpm test
    test-e2e: pnpm test:e2e
    coverage: pnpm coverage
    lint: pnpm lint
    typecheck: pnpm typecheck
    validate-links: pnpm validate:links
    audit-a11y: pnpm audit:a11y
  ci:
    required-checks:
      - lint
      - typecheck
      - test-unit
      - test-e2e
      - test-visual
      - coverage
      - validate-links
      - audit-a11y
    ai-guardrails:
      test-coverage-check: "Verifies code changes in app/ or lib/ have corresponding tests"
      pr-template-check: "Validates PR template compliance and ADR links for architecture changes"
  pr:
    template: .github/PULL_REQUEST_TEMPLATE.md
    require:
      - context
      - changes-summary
      - tests
      - risk-and-rollback
      - governance-compliance
      - ai-guardrails-compliance
    adr-required-for:
      - architecture-change

ai-governance:
  sources-of-truth:
    - ./sdd.yaml
    - ./docs/ARCHITECTURE.md
    - ./docs/ERROR_HANDLING.md
    - ./.github/copilot-instructions.md
  decision-criteria:
    i18n-routing: |
      All user-facing routes must respect the [lang] parameter from the App Router.
      - Page components: Read lang from params.lang, never hardcode locale
      - Metadata: Must generate per-locale using the lang param
      - OG images: Must accept params: Promise<{ lang: Locale }> and render translated content
      - Links: Always use /[lang]/ prefixes, never hardcode /en/ or /es/
    component-placement: |
      UI components belong in app/components/ (shared, stateless, accept props).
      Business logic and utilities belong in lib/* (no React dependencies, pure functions where possible).
      API routes contain schema validation and external service calls, not business rules.
    testing-expectations: |
      New features must include unit tests (Vitest) and maintain >95% function coverage.
      Routes must have E2E tests (Playwright) verifying happy path and error cases.
      Components must test props, event handlers, and accessibility (ARIA, semantic HTML).
      AI Guardrails enforce test coverage: code changes in app/ or lib/ require test updates.
    architecture-decisions: |
      PRs labeled 'architecture-change' must link to an ADR in docs/adr/.
      Use the ADR template (docs/adr/adr-template.md) to document rationale, alternatives, and consequences.
      See ADR-0001 for an example: docs/adr/0001-implement-ai-guardrails.md
  rules:
    - "Prefer existing patterns and files when adding new functionality."
    - "When adding new dependencies, include justification in the PR description."
    - "Always wire new routes, components, or APIs into lint, typecheck, and tests."
    - "All user-visible text must be i18n-aware: never hardcode English-only content."
    - "Opengraph and metadata routes must be locale-aware; accept lang param and translate."
    - "When modifying sdd.yaml, ARCHITECTURE.md, or ERROR_HANDLING.md, ensure consistency across all three."
    - "Use async/await syntax; avoid .then() chains unless necessary."
    - "Code changes in app/ or lib/ must include corresponding test changes (enforced by AI Guardrails)."
    - "Architecture changes require an ADR and the 'architecture-change' label (enforced by AI Guardrails)."
  safety:
    - "Never hard-code secrets or tokens; always read from environment variables."
    - "Avoid introducing breaking changes to security headers without review."
